# Code generated by KubeVela templates. DO NOT EDIT. Please edit the original cue file.
# Definition source cue file: vela-templates/definitions/internal/service-account.cue
apiVersion: core.oam.dev/v1beta1
kind: TraitDefinition
metadata:
  annotations:
    definition.oam.dev/description: Specify serviceAccount for your workload which follows the pod spec in path 'spec.template'.
  name: service-account
  namespace: dynamic_parameters
spec:
  appliesToWorkloads:
    - deployments.apps
    - statefulsets.apps
    - daemonsets.apps
    - jobs.batch
  podDisruptive: false
  schematic:
    cue:
      template: |
        	// +usage=Specify the verbs to be allowed for the resource
        	verbs: [...string]
        	// +usage=Specify the apiGroups of the resource
        	apiGroups?: [...string]
        	// +usage=Specify the resources to be allowed
        	resources?: [...string]
        	// +usage=Specify the resourceNames to be allowed
        	resourceNames?: [...string]
        	// +usage=Specify the resource url to be allowed
        	nonResourceURLs?: [...string]
        	// +usage=Specify the scope of the privileges, default to be namespace scope
        	scope: *"namespace" | "cluster"
        	// +usage=Specify the name of ServiceAccount
        	name: string
        	// +usage=Specify whether to create new ServiceAccount or not
        	create: *false | bool
        	// +usage=Specify the privileges of the ServiceAccount, if not empty, RoleBindings(ClusterRoleBindings) will be created
        	privileges?: [...#Privileges]
        // +patchStrategy=retainKeys
        patch: spec: template: spec: serviceAccountName: parameter.name

        			apiVersion: "v1"
        			kind:       "ServiceAccount"
        			metadata: name: parameter.name
        				apiVersion: "rbac.authorization.k8s.io/v1"
        				kind:       "ClusterRole"
        				metadata: name: "\(context.namespace):\(parameter.name)"
        					verbs: p.verbs
        						apiGroups: p.apiGroups
        						resources: p.resources
        						resourceNames: p.resourceNames
        						nonResourceURLs: p.nonResourceURLs
        				apiVersion: "rbac.authorization.k8s.io/v1"
        				kind:       "ClusterRoleBinding"
        				metadata: name: "\(context.namespace):\(parameter.name)"
        					apiGroup: "rbac.authorization.k8s.io"
        					kind:     "ClusterRole"
        					name:     "\(context.namespace):\(parameter.name)"
        					kind:      "ServiceAccount"
        					name:      parameter.name
        					namespace: (context.namespace)
        				apiVersion: "rbac.authorization.k8s.io/v1"
        				kind:       "Role"
        				metadata: name: parameter.name
        					verbs: p.verbs
        						apiGroups: p.apiGroups
        						resources: p.resources
        						resourceNames: p.resourceNames
        						nonResourceURLs: p.nonResourceURLs
        				apiVersion: "rbac.authorization.k8s.io/v1"
        				kind:       "RoleBinding"
        				metadata: name: parameter.name
        					apiGroup: "rbac.authorization.k8s.io"
        					kind:     "Role"
        					name:     parameter.name
        					kind: "ServiceAccount"
        					name: parameter.name


---
