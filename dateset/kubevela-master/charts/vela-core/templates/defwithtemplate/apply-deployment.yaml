# Code generated by KubeVela templates. DO NOT EDIT. Please edit the original cue file.
# Definition source cue file: vela-templates/definitions/internal/apply-deployment.cue
apiVersion: core.oam.dev/v1beta1
kind: WorkflowStepDefinition
metadata:
  annotations:
    custom.definition.oam.dev/category: Resource Management
    definition.oam.dev/alias: ""
    definition.oam.dev/description: Apply deployment with specified image and cmd.
  name: apply-deployment
  namespace: dynamic_parameters
spec:
  schematic:
    cue:
      template: |
        import (
        	"strconv"
        	"strings"
        	"vela/op"
        )

        	cluster: parameter.cluster
        		apiVersion: "apps/v1"
        		kind:       "Deployment"
        			name:      context.stepName
        			namespace: context.namespace
        			selector: matchLabels: "workflow.oam.dev/step-name": "\(context.name)-\(context.stepName)"
        			replicas: parameter.replicas
        				metadata: labels: "workflow.oam.dev/step-name": "\(context.name)-\(context.stepName)"
        					name:  context.stepName
        					image: parameter.image
        						command: parameter.cmd
        	continue: output.value.status.readyReplicas == parameter.replicas
        	image:    string
        	replicas: *1 | int
        	cluster:  *"" | string
        	cmd?: [...string]


---
