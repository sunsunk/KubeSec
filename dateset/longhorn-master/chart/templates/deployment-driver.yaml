apiVersion: apps/v1
kind: Deployment
metadata:
  name: longhorn-driver-deployer
  namespace: dynamic_parameters
  labels: 
spec:
  replicas: 1
  selector:
    matchLabels:
      app: longhorn-driver-deployer
  template:
    metadata:
      labels: 
        app: longhorn-driver-deployer
    spec:
      initContainers:
        - name: wait-longhorn-manager
          image: dynamic_parametersdynamic_parameters:dynamic_parameters
      containers:
        - name: longhorn-driver-deployer
          image: dynamic_parametersdynamic_parameters:dynamic_parameters
          imagePullPolicy: dynamic_parameters
          command:
          - longhorn-manager
          - -d
          - deploy-driver
          - --manager-image
          - "dynamic_parametersdynamic_parameters:dynamic_parameters"
          - --manager-url
          - http://longhorn-backend:9500/v1
          env:
          - name: POD_NAMESPACE
            valueFrom:
              fieldRef:
                fieldPath: metadata.namespace
          - name: NODE_NAME
            valueFrom:
              fieldRef:
                fieldPath: spec.nodeName
          - name: SERVICE_ACCOUNT
            valueFrom:
              fieldRef:
                fieldPath: spec.serviceAccountName
          - name: KUBELET_ROOT_DIR
            value: dynamic_parameters
          - name: CSI_ATTACHER_IMAGE
            value: "dynamic_parametersdynamic_parameters:dynamic_parameters"
          - name: CSI_PROVISIONER_IMAGE
            value: "dynamic_parametersdynamic_parameters:dynamic_parameters"
          - name: CSI_NODE_DRIVER_REGISTRAR_IMAGE
            value: "dynamic_parametersdynamic_parameters:dynamic_parameters"
          - name: CSI_RESIZER_IMAGE
            value: "dynamic_parametersdynamic_parameters:dynamic_parameters"
          - name: CSI_SNAPSHOTTER_IMAGE
            value: "dynamic_parametersdynamic_parameters:dynamic_parameters"
          - name: CSI_LIVENESS_PROBE_IMAGE
            value: "dynamic_parametersdynamic_parameters:dynamic_parameters"
          - name: CSI_ATTACHER_REPLICA_COUNT
            value: dynamic_parameters
          - name: CSI_PROVISIONER_REPLICA_COUNT
            value: dynamic_parameters
          - name: CSI_RESIZER_REPLICA_COUNT
            value: dynamic_parameters
          - name: CSI_SNAPSHOTTER_REPLICA_COUNT
            value: dynamic_parameters
          - name: GOCOVERDIR
            value: /go-cover-dir/
          volumeMounts:
          - name: go-cover-dir
            mountPath: /go-cover-dir/

      imagePullSecrets:
      - name: dynamic_parameters
      priorityClassName: dynamic_parameters
      tolerations:
      nodeSelector:
      serviceAccountName: longhorn-service-account
      securityContext:
        runAsUser: 0
      volumes:
      - name: go-cover-dir
        hostPath:
          path: /go-cover-dir/
          type: DirectoryOrCreate

---
