apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: dynamic_parameters:migrate-resources
  labels:
    
  annotations:
    helm.sh/hook: post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation,hook-succeeded,hook-failed
    helm.sh/hook-weight: "100"
rules:
  - apiGroups:
    - kyverno.io
    resources:
    - '*'
    verbs:
    - get
    - list
    - update
  - apiGroups:
    - apiextensions.k8s.io
    resources:
    - customresourcedefinitions
    verbs:
    - get
  - apiGroups:
    - apiextensions.k8s.io
    resources:
    - customresourcedefinitions/status
    verbs:
    - update
---
kind: ClusterRoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: dynamic_parameters:migrate-resources
  labels:
    
  annotations:
    helm.sh/hook: post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation,hook-succeeded,hook-failed
    helm.sh/hook-weight: "100"
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: dynamic_parameters:migrate-resources
subjects:
  - kind: ServiceAccount
    name: dynamic_parameters-migrate-resources
    namespace: dynamic_parameters
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: dynamic_parameters-migrate-resources
  namespace: dynamic_parameters
  labels:
    
  annotations:
    helm.sh/hook: post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation,hook-succeeded
    helm.sh/hook-weight: "100"
---
apiVersion: batch/v1
kind: Job
metadata:
  name: dynamic_parameters-migrate-resources
  namespace: dynamic_parameters
  labels:
    
  annotations:
    helm.sh/hook: post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation,hook-succeeded,hook-failed
    helm.sh/hook-weight: "200"
spec:
  backoffLimit: 2
  template:
    metadata:
      labels:
    spec:
      serviceAccount: dynamic_parameters-migrate-resources
      securityContext:
      restartPolicy: Never
      containers:
        - name: kubectl
          image: dynamic_parameters
          imagePullPolicy: dynamic_parameters
          args:
            - migrate
            - --resource
            - dynamic_parameters
          securityContext:
      imagePullSecrets:
      tolerations:
      nodeSelector:
      affinity:
        podAntiAffinity:
        podAffinity:
        nodeAffinity:

---
