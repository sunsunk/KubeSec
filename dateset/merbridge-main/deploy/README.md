# Helm Charts for Merbridge

> Note that the files in `deploy` are auto generated by Helm.

## Install Guide

If you want to install merbridge locally with Helm:

> Note that: execute these commands in root dir of merbridge.

### Install Merbridge on Istio

+ Set `mode=istio` to switch to Istio mode. Default value is `istio`.
+ Set a namespace where merbridge is going to install by `-n`.

``` bash
helm install -n istio-system merbridge helm
```

After executing this command, you will see that:

```
NAME: merbridge
LAST DEPLOYED: Mon Feb 21 01:37:40 2022
NAMESPACE: istio-system
STATUS: deployed
REVISION: 1
TEST SUITE: None
NOTES:
Welcome to Merbridge! For more details on Merbridge, see: https://github.com/merbridge/merbridge

The Merbridge [v0.4.0] has been installed in namespace [istio-system]. It will be ready soon.

(Helm: Chart=[merbridge], Release=[merbridge], Version=[v0.4.0])
```

### Install Merbridge on Linkerd

+ Set `mode=linkerd` to switch to linkerd mode
+ Set a namespace where merbridge is going to install by `-n`

``` bash
helm install -n linkerd --set mode=linkerd merbridge helm
```

### Install Merbridge on Kuma

+ Set `mode=kuma` to switch to kuma mode
+ Set a namespace where merbridge is going to install by `-n`

``` bash
helm install -n kuma-system --set mode=kuma merbridge helm
```

### Install Merbridge on OSM/OSM-Edge

+ Set `mode=osm` to switch to [OSM](https://github.com/openservicemesh/osm)/[OSM-Edge](https://github.com/flomesh-io/osm-edge) mode
+ Specify a namespace where you want to install Merbridge using `-n`

``` bash
helm install -n osm-system --set mode=osm merbridge helm
```

### Uninstall

+ Execute this command in the namespace where merbridge has been installed
+ Or add `-n` to specify the namespace where merbridge has been installed

``` bash
helm uninstall merbridge
```

## Development

If you want to update yamls in the `deploy` directory, please make changes into helm charts.

After that, remember to update generated yamls in the `deploy` directory.

``` bash
# update both istio, kuma and linkerd
make helm
# update istio deploy yaml
make helm-istio
# update linkerd deploy yaml
make helm-linkerd
# update kuma deploy yaml
make helm-kuma
# update osm deploy yaml
make helm-osm
# package helm charts
make helm-package
```

## TODO
- [ ] Provide Helm Repo Server to install Merbridge
