default:
	make gen-api-spec
	cargo test

gen-api-spec:
	mkdir -p target

	cargo clean -q

	KCLVM_RUNTIME_GEN_API_SPEC= cargo build > ./src/_kclvm_api_spec.rs.tmp

	echo "// Copyright 2023 The KCL Authors. All rights reserved.\n" > ./src/_kclvm_api_spec.rs
	echo "// Auto generated by <make gen-api-spec> command, DONOT EDIT!!!\n" >> ./src/_kclvm_api_spec.rs
	cat ./src/_kclvm_api_spec.rs.tmp >> ./src/_kclvm_api_spec.rs
	rm  ./src/_kclvm_api_spec.rs.tmp

	make -C ./tools/kclvm-runtime-gen-api
